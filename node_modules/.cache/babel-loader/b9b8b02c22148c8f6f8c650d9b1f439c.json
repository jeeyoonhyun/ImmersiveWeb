{"ast":null,"code":"import _classCallCheck from \"/Users/jeeyoonhyun/immersive-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jeeyoonhyun/immersive-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { BufferGeometry, Clock, Float32BufferAttribute, LinearFilter, Mesh, OrthographicCamera, RGBAFormat, Vector2, WebGLRenderTarget } from 'three';\nimport { CopyShader } from '../shaders/CopyShader.js';\nimport { ShaderPass } from '../postprocessing/ShaderPass.js';\nimport { MaskPass } from '../postprocessing/MaskPass.js';\nimport { ClearMaskPass } from '../postprocessing/MaskPass.js';\n\nvar EffectComposer = /*#__PURE__*/function () {\n  function EffectComposer(renderer, renderTarget) {\n    _classCallCheck(this, EffectComposer);\n\n    this.renderer = renderer;\n\n    if (renderTarget === undefined) {\n      var parameters = {\n        minFilter: LinearFilter,\n        magFilter: LinearFilter,\n        format: RGBAFormat\n      };\n      var size = renderer.getSize(new Vector2());\n      this._pixelRatio = renderer.getPixelRatio();\n      this._width = size.width;\n      this._height = size.height;\n      renderTarget = new WebGLRenderTarget(this._width * this._pixelRatio, this._height * this._pixelRatio, parameters);\n      renderTarget.texture.name = 'EffectComposer.rt1';\n    } else {\n      this._pixelRatio = 1;\n      this._width = renderTarget.width;\n      this._height = renderTarget.height;\n    }\n\n    this.renderTarget1 = renderTarget;\n    this.renderTarget2 = renderTarget.clone();\n    this.renderTarget2.texture.name = 'EffectComposer.rt2';\n    this.writeBuffer = this.renderTarget1;\n    this.readBuffer = this.renderTarget2;\n    this.renderToScreen = true;\n    this.passes = []; // dependencies\n\n    if (CopyShader === undefined) {\n      console.error('THREE.EffectComposer relies on CopyShader');\n    }\n\n    if (ShaderPass === undefined) {\n      console.error('THREE.EffectComposer relies on ShaderPass');\n    }\n\n    this.copyPass = new ShaderPass(CopyShader);\n    this.clock = new Clock();\n  }\n\n  _createClass(EffectComposer, [{\n    key: \"swapBuffers\",\n    value: function swapBuffers() {\n      var tmp = this.readBuffer;\n      this.readBuffer = this.writeBuffer;\n      this.writeBuffer = tmp;\n    }\n  }, {\n    key: \"addPass\",\n    value: function addPass(pass) {\n      this.passes.push(pass);\n      pass.setSize(this._width * this._pixelRatio, this._height * this._pixelRatio);\n    }\n  }, {\n    key: \"insertPass\",\n    value: function insertPass(pass, index) {\n      this.passes.splice(index, 0, pass);\n      pass.setSize(this._width * this._pixelRatio, this._height * this._pixelRatio);\n    }\n  }, {\n    key: \"removePass\",\n    value: function removePass(pass) {\n      var index = this.passes.indexOf(pass);\n\n      if (index !== -1) {\n        this.passes.splice(index, 1);\n      }\n    }\n  }, {\n    key: \"isLastEnabledPass\",\n    value: function isLastEnabledPass(passIndex) {\n      for (var i = passIndex + 1; i < this.passes.length; i++) {\n        if (this.passes[i].enabled) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n  }, {\n    key: \"render\",\n    value: function render(deltaTime) {\n      // deltaTime value is in seconds\n      if (deltaTime === undefined) {\n        deltaTime = this.clock.getDelta();\n      }\n\n      var currentRenderTarget = this.renderer.getRenderTarget();\n      var maskActive = false;\n\n      for (var i = 0, il = this.passes.length; i < il; i++) {\n        var pass = this.passes[i];\n        if (pass.enabled === false) continue;\n        pass.renderToScreen = this.renderToScreen && this.isLastEnabledPass(i);\n        pass.render(this.renderer, this.writeBuffer, this.readBuffer, deltaTime, maskActive);\n\n        if (pass.needsSwap) {\n          if (maskActive) {\n            var context = this.renderer.getContext();\n            var stencil = this.renderer.state.buffers.stencil; //context.stencilFunc( context.NOTEQUAL, 1, 0xffffffff );\n\n            stencil.setFunc(context.NOTEQUAL, 1, 0xffffffff);\n            this.copyPass.render(this.renderer, this.writeBuffer, this.readBuffer, deltaTime); //context.stencilFunc( context.EQUAL, 1, 0xffffffff );\n\n            stencil.setFunc(context.EQUAL, 1, 0xffffffff);\n          }\n\n          this.swapBuffers();\n        }\n\n        if (MaskPass !== undefined) {\n          if (pass instanceof MaskPass) {\n            maskActive = true;\n          } else if (pass instanceof ClearMaskPass) {\n            maskActive = false;\n          }\n        }\n      }\n\n      this.renderer.setRenderTarget(currentRenderTarget);\n    }\n  }, {\n    key: \"reset\",\n    value: function reset(renderTarget) {\n      if (renderTarget === undefined) {\n        var size = this.renderer.getSize(new Vector2());\n        this._pixelRatio = this.renderer.getPixelRatio();\n        this._width = size.width;\n        this._height = size.height;\n        renderTarget = this.renderTarget1.clone();\n        renderTarget.setSize(this._width * this._pixelRatio, this._height * this._pixelRatio);\n      }\n\n      this.renderTarget1.dispose();\n      this.renderTarget2.dispose();\n      this.renderTarget1 = renderTarget;\n      this.renderTarget2 = renderTarget.clone();\n      this.writeBuffer = this.renderTarget1;\n      this.readBuffer = this.renderTarget2;\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(width, height) {\n      this._width = width;\n      this._height = height;\n      var effectiveWidth = this._width * this._pixelRatio;\n      var effectiveHeight = this._height * this._pixelRatio;\n      this.renderTarget1.setSize(effectiveWidth, effectiveHeight);\n      this.renderTarget2.setSize(effectiveWidth, effectiveHeight);\n\n      for (var i = 0; i < this.passes.length; i++) {\n        this.passes[i].setSize(effectiveWidth, effectiveHeight);\n      }\n    }\n  }, {\n    key: \"setPixelRatio\",\n    value: function setPixelRatio(pixelRatio) {\n      this._pixelRatio = pixelRatio;\n      this.setSize(this._width, this._height);\n    }\n  }]);\n\n  return EffectComposer;\n}();\n\nvar Pass = /*#__PURE__*/function () {\n  function Pass() {\n    _classCallCheck(this, Pass);\n\n    // if set to true, the pass is processed by the composer\n    this.enabled = true; // if set to true, the pass indicates to swap read and write buffer after rendering\n\n    this.needsSwap = true; // if set to true, the pass clears its buffer before rendering\n\n    this.clear = false; // if set to true, the result of the pass is rendered to screen. This is set automatically by EffectComposer.\n\n    this.renderToScreen = false;\n  }\n\n  _createClass(Pass, [{\n    key: \"setSize\",\n    value: function setSize()\n    /* width, height */\n    {}\n  }, {\n    key: \"render\",\n    value: function render()\n    /* renderer, writeBuffer, readBuffer, deltaTime, maskActive */\n    {\n      console.error('THREE.Pass: .render() must be implemented in derived pass.');\n    }\n  }]);\n\n  return Pass;\n}(); // Helper for passes that need to fill the viewport with a single quad.\n\n\nvar _camera = new OrthographicCamera(-1, 1, 1, -1, 0, 1); // https://github.com/mrdoob/three.js/pull/21358\n\n\nvar _geometry = new BufferGeometry();\n\n_geometry.setAttribute('position', new Float32BufferAttribute([-1, 3, 0, -1, -1, 0, 3, -1, 0], 3));\n\n_geometry.setAttribute('uv', new Float32BufferAttribute([0, 2, 0, 0, 2, 0], 2));\n\nvar FullScreenQuad = /*#__PURE__*/function () {\n  function FullScreenQuad(material) {\n    _classCallCheck(this, FullScreenQuad);\n\n    this._mesh = new Mesh(_geometry, material);\n  }\n\n  _createClass(FullScreenQuad, [{\n    key: \"dispose\",\n    value: function dispose() {\n      this._mesh.geometry.dispose();\n    }\n  }, {\n    key: \"render\",\n    value: function render(renderer) {\n      renderer.render(this._mesh, _camera);\n    }\n  }, {\n    key: \"material\",\n    get: function get() {\n      return this._mesh.material;\n    },\n    set: function set(value) {\n      this._mesh.material = value;\n    }\n  }]);\n\n  return FullScreenQuad;\n}();\n\nexport { EffectComposer, Pass, FullScreenQuad };","map":{"version":3,"sources":["/Users/jeeyoonhyun/immersive-web/node_modules/three/examples/jsm/postprocessing/EffectComposer.js"],"names":["BufferGeometry","Clock","Float32BufferAttribute","LinearFilter","Mesh","OrthographicCamera","RGBAFormat","Vector2","WebGLRenderTarget","CopyShader","ShaderPass","MaskPass","ClearMaskPass","EffectComposer","renderer","renderTarget","undefined","parameters","minFilter","magFilter","format","size","getSize","_pixelRatio","getPixelRatio","_width","width","_height","height","texture","name","renderTarget1","renderTarget2","clone","writeBuffer","readBuffer","renderToScreen","passes","console","error","copyPass","clock","tmp","pass","push","setSize","index","splice","indexOf","passIndex","i","length","enabled","deltaTime","getDelta","currentRenderTarget","getRenderTarget","maskActive","il","isLastEnabledPass","render","needsSwap","context","getContext","stencil","state","buffers","setFunc","NOTEQUAL","EQUAL","swapBuffers","setRenderTarget","dispose","effectiveWidth","effectiveHeight","pixelRatio","Pass","clear","_camera","_geometry","setAttribute","FullScreenQuad","material","_mesh","geometry","value"],"mappings":"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","sourcesContent":["import {\n\tBufferGeometry,\n\tClock,\n\tFloat32BufferAttribute,\n\tLinearFilter,\n\tMesh,\n\tOrthographicCamera,\n\tRGBAFormat,\n\tVector2,\n\tWebGLRenderTarget\n} from 'three';\nimport { CopyShader } from '../shaders/CopyShader.js';\nimport { ShaderPass } from '../postprocessing/ShaderPass.js';\nimport { MaskPass } from '../postprocessing/MaskPass.js';\nimport { ClearMaskPass } from '../postprocessing/MaskPass.js';\n\nclass EffectComposer {\n\n\tconstructor( renderer, renderTarget ) {\n\n\t\tthis.renderer = renderer;\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tconst parameters = {\n\t\t\t\tminFilter: LinearFilter,\n\t\t\t\tmagFilter: LinearFilter,\n\t\t\t\tformat: RGBAFormat\n\t\t\t};\n\n\t\t\tconst size = renderer.getSize( new Vector2() );\n\t\t\tthis._pixelRatio = renderer.getPixelRatio();\n\t\t\tthis._width = size.width;\n\t\t\tthis._height = size.height;\n\n\t\t\trenderTarget = new WebGLRenderTarget( this._width * this._pixelRatio, this._height * this._pixelRatio, parameters );\n\t\t\trenderTarget.texture.name = 'EffectComposer.rt1';\n\n\t\t} else {\n\n\t\t\tthis._pixelRatio = 1;\n\t\t\tthis._width = renderTarget.width;\n\t\t\tthis._height = renderTarget.height;\n\n\t\t}\n\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\t\tthis.renderTarget2.texture.name = 'EffectComposer.rt2';\n\n\t\tthis.writeBuffer = this.renderTarget1;\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t\tthis.renderToScreen = true;\n\n\t\tthis.passes = [];\n\n\t\t// dependencies\n\n\t\tif ( CopyShader === undefined ) {\n\n\t\t\tconsole.error( 'THREE.EffectComposer relies on CopyShader' );\n\n\t\t}\n\n\t\tif ( ShaderPass === undefined ) {\n\n\t\t\tconsole.error( 'THREE.EffectComposer relies on ShaderPass' );\n\n\t\t}\n\n\t\tthis.copyPass = new ShaderPass( CopyShader );\n\n\t\tthis.clock = new Clock();\n\n\t}\n\n\tswapBuffers() {\n\n\t\tconst tmp = this.readBuffer;\n\t\tthis.readBuffer = this.writeBuffer;\n\t\tthis.writeBuffer = tmp;\n\n\t}\n\n\taddPass( pass ) {\n\n\t\tthis.passes.push( pass );\n\t\tpass.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t}\n\n\tinsertPass( pass, index ) {\n\n\t\tthis.passes.splice( index, 0, pass );\n\t\tpass.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t}\n\n\tremovePass( pass ) {\n\n\t\tconst index = this.passes.indexOf( pass );\n\n\t\tif ( index !== - 1 ) {\n\n\t\t\tthis.passes.splice( index, 1 );\n\n\t\t}\n\n\t}\n\n\tisLastEnabledPass( passIndex ) {\n\n\t\tfor ( let i = passIndex + 1; i < this.passes.length; i ++ ) {\n\n\t\t\tif ( this.passes[ i ].enabled ) {\n\n\t\t\t\treturn false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn true;\n\n\t}\n\n\trender( deltaTime ) {\n\n\t\t// deltaTime value is in seconds\n\n\t\tif ( deltaTime === undefined ) {\n\n\t\t\tdeltaTime = this.clock.getDelta();\n\n\t\t}\n\n\t\tconst currentRenderTarget = this.renderer.getRenderTarget();\n\n\t\tlet maskActive = false;\n\n\t\tfor ( let i = 0, il = this.passes.length; i < il; i ++ ) {\n\n\t\t\tconst pass = this.passes[ i ];\n\n\t\t\tif ( pass.enabled === false ) continue;\n\n\t\t\tpass.renderToScreen = ( this.renderToScreen && this.isLastEnabledPass( i ) );\n\t\t\tpass.render( this.renderer, this.writeBuffer, this.readBuffer, deltaTime, maskActive );\n\n\t\t\tif ( pass.needsSwap ) {\n\n\t\t\t\tif ( maskActive ) {\n\n\t\t\t\t\tconst context = this.renderer.getContext();\n\t\t\t\t\tconst stencil = this.renderer.state.buffers.stencil;\n\n\t\t\t\t\t//context.stencilFunc( context.NOTEQUAL, 1, 0xffffffff );\n\t\t\t\t\tstencil.setFunc( context.NOTEQUAL, 1, 0xffffffff );\n\n\t\t\t\t\tthis.copyPass.render( this.renderer, this.writeBuffer, this.readBuffer, deltaTime );\n\n\t\t\t\t\t//context.stencilFunc( context.EQUAL, 1, 0xffffffff );\n\t\t\t\t\tstencil.setFunc( context.EQUAL, 1, 0xffffffff );\n\n\t\t\t\t}\n\n\t\t\t\tthis.swapBuffers();\n\n\t\t\t}\n\n\t\t\tif ( MaskPass !== undefined ) {\n\n\t\t\t\tif ( pass instanceof MaskPass ) {\n\n\t\t\t\t\tmaskActive = true;\n\n\t\t\t\t} else if ( pass instanceof ClearMaskPass ) {\n\n\t\t\t\t\tmaskActive = false;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.renderer.setRenderTarget( currentRenderTarget );\n\n\t}\n\n\treset( renderTarget ) {\n\n\t\tif ( renderTarget === undefined ) {\n\n\t\t\tconst size = this.renderer.getSize( new Vector2() );\n\t\t\tthis._pixelRatio = this.renderer.getPixelRatio();\n\t\t\tthis._width = size.width;\n\t\t\tthis._height = size.height;\n\n\t\t\trenderTarget = this.renderTarget1.clone();\n\t\t\trenderTarget.setSize( this._width * this._pixelRatio, this._height * this._pixelRatio );\n\n\t\t}\n\n\t\tthis.renderTarget1.dispose();\n\t\tthis.renderTarget2.dispose();\n\t\tthis.renderTarget1 = renderTarget;\n\t\tthis.renderTarget2 = renderTarget.clone();\n\n\t\tthis.writeBuffer = this.renderTarget1;\n\t\tthis.readBuffer = this.renderTarget2;\n\n\t}\n\n\tsetSize( width, height ) {\n\n\t\tthis._width = width;\n\t\tthis._height = height;\n\n\t\tconst effectiveWidth = this._width * this._pixelRatio;\n\t\tconst effectiveHeight = this._height * this._pixelRatio;\n\n\t\tthis.renderTarget1.setSize( effectiveWidth, effectiveHeight );\n\t\tthis.renderTarget2.setSize( effectiveWidth, effectiveHeight );\n\n\t\tfor ( let i = 0; i < this.passes.length; i ++ ) {\n\n\t\t\tthis.passes[ i ].setSize( effectiveWidth, effectiveHeight );\n\n\t\t}\n\n\t}\n\n\tsetPixelRatio( pixelRatio ) {\n\n\t\tthis._pixelRatio = pixelRatio;\n\n\t\tthis.setSize( this._width, this._height );\n\n\t}\n\n}\n\n\nclass Pass {\n\n\tconstructor() {\n\n\t\t// if set to true, the pass is processed by the composer\n\t\tthis.enabled = true;\n\n\t\t// if set to true, the pass indicates to swap read and write buffer after rendering\n\t\tthis.needsSwap = true;\n\n\t\t// if set to true, the pass clears its buffer before rendering\n\t\tthis.clear = false;\n\n\t\t// if set to true, the result of the pass is rendered to screen. This is set automatically by EffectComposer.\n\t\tthis.renderToScreen = false;\n\n\t}\n\n\tsetSize( /* width, height */ ) {}\n\n\trender( /* renderer, writeBuffer, readBuffer, deltaTime, maskActive */ ) {\n\n\t\tconsole.error( 'THREE.Pass: .render() must be implemented in derived pass.' );\n\n\t}\n\n}\n\n// Helper for passes that need to fill the viewport with a single quad.\n\nconst _camera = new OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );\n\n// https://github.com/mrdoob/three.js/pull/21358\n\nconst _geometry = new BufferGeometry();\n_geometry.setAttribute( 'position', new Float32BufferAttribute( [ - 1, 3, 0, - 1, - 1, 0, 3, - 1, 0 ], 3 ) );\n_geometry.setAttribute( 'uv', new Float32BufferAttribute( [ 0, 2, 0, 0, 2, 0 ], 2 ) );\n\nclass FullScreenQuad {\n\n\tconstructor( material ) {\n\n\t\tthis._mesh = new Mesh( _geometry, material );\n\n\t}\n\n\tdispose() {\n\n\t\tthis._mesh.geometry.dispose();\n\n\t}\n\n\trender( renderer ) {\n\n\t\trenderer.render( this._mesh, _camera );\n\n\t}\n\n\tget material() {\n\n\t\treturn this._mesh.material;\n\n\t}\n\n\tset material( value ) {\n\n\t\tthis._mesh.material = value;\n\n\t}\n\n}\n\nexport { EffectComposer, Pass, FullScreenQuad };\n"]},"metadata":{},"sourceType":"module"}